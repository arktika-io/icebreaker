on:
  push:
    branches:
      - main
    paths:
      - version

permissions:
  id-token: write
  contents: read

env:
  TWINE_NON_INTERACTIVE: "true"

jobs:
  release:
    runs-on: ${{ matrix.packages.os }}

    strategy:
      fail-fast: false

      matrix:
        packages:
          - {os: "ubuntu-latest", python-version: "3.12", package: "python-sdist"}
          - {os: "ubuntu-latest", python-version: "3.12", package: "python-wheel"}

    steps:
      - uses: actions/checkout@v4
      - run: ./bin/setup
      - run: ./bin/package-${{ matrix.packages.package }}
      - uses: pypa/gh-action-pypi-publish@release/v1
        with:
          print-hash: true
